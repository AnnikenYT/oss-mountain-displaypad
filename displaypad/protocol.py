"""Protocol helpers and constants for the DisplayPad device."""
import binascii
import struct

URB_HEADERS = {
    'GetTFTSleepTime': bytearray([0x22, 0x00, 0x00, 0x10]),
    'APEnable': bytearray([0x11, 0x80, 0, 0]),
    'SetTFTSleepTime': bytearray([0x22, 0x10]),
    'SetPanelImage': bytearray([0x21, 0x00, 0x00, 0x1]),
    'DisplayLogo': bytearray([0x23]),
    'GetMainBrightness': bytearray([0x10, 0x00, 0x01, 0x20]),
    'SetMainBrightness': bytearray([0x31, 0x20]),
}


KEYMAP = [
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000',
    b'01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000',
]


def parse_response(msg: bytes) -> bytes:
    """Return hexlified representation of the response bytes as bytes.

    This matches the existing code which compares hex strings.
    """
    return binascii.hexlify(msg)


def pack_message(message: bytes, buff_size: int = 64) -> bytes:
    """Pack a message into a fixed-size buffer for interrupt transfers."""
    rem_buff = int(buff_size - len(message))
    message = bytearray(message)
    packed_message = struct.pack(f'<{len(message)}s{rem_buff}x', message)
    return packed_message
